issuer: "https://{{ domain_name_dex }}"

web:
  http: 0.0.0.0:5556

telemetry:
  http: 0.0.0.0:5558

storage:
  type: sqlite3
  config:
    file: /var/dex/dex.db

oauth2:
  skipApprovalScreen: true

staticClients:
- id: "{{ grafana_oauth_client_id }}"
  secret: "{{ '{{ file.Read "/run/secrets/grafana_oauth_client_secret" }}' }}"
  name: "Grafana"
  redirectURIs:
  - "https://{{ domain_name_grafana }}/login/generic_oauth"
- id: "{{ oauth2proxy_oauth_client_id }}"
  secret: "{{ '{{ file.Read "/run/secrets/oauth2proxy_oauth_client_secret" }}' }}"
  name: "OAuth2Proxy"
  redirectURIs:
  - "https://{{ domain_name_victoriametrics }}/oauth2/callback"

{% if dex_github %}
connectors:
- type: github
  id: github
  name: GitHub
  config:
    clientID: "{{ github_client_id }}"
    clientSecret: "{{ '{{ file.Read "/run/secrets/github_client_secret" }}' }}"
    redirectURI: "https://{{ domain_name_dex }}/callback"
    orgs:
    - name: "{{ github_org }}"
    teamNameField: slug
    useLoginAsID: false
{% endif %}

{% if dex_local_admin %}
enablePasswordDB: true

staticPasswords:
  - email: "admin@local"
    hash: "{{ dex_local_admin_password }}"
    username: "admin"
    userID: "08a8684b-db88-4b73-90a9-3cd1661f5466"
{% endif %}
